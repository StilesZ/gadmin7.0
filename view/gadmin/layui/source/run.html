{include file='common/head' /}
<link rel="stylesheet" type="text/css" href="/static/sfdp/lib/codemirror/codemirror.css" />
<link rel="stylesheet" type="text/css" href="/static/sfdp/lib/codemirror/dracula.css" />
</head>
<body>
<div class="layui-fluid" style="background-color:#FFFFFF;" >
            <div class="layui-card-body"style="height:calc(100% - 10px);">
                <div class="layui-row" >
                        <fieldset class="layui-elem-field layui-field-title"  >
                            <legend>运行测试数据 - Join</legend>
                        </fieldset>
                        <textarea placeholder="请填写JQ脚本代码！" name='function' type="text/plain" style="width:100%;height:450px;display:inline-block;" id='code'></textarea>
            </div>

        </div>
    {eq name='where' value='1'}
    <div class="layui-form-item">
        <label class="layui-form-label">传递参数</label>
        <div class="layui-input-inline" style="width: 80%">
            <input type="text" id="where"  autocomplete="off" placeholder="请按where条件中，写入{id:1}" class="layui-input">
        </div>
    </div>
    {/eq}
            <div style="text-align: center">
                <a  class=" layui-btn btn-24 layui-btn-sm" onclick="window.location.reload()"> 刷新页面</a>
                <a id="edit" class=" layui-btn btn-22 layui-btn-sm" onclick="test()"> 执行测试</a>
                <a id="run" class=" layui-btn btn-23 layui-btn-sm" onclick="layer_close()"> 关闭页面</a>
            </div>


</div>

{include file="common/footer"/}
<script src="/static/sfdp/lib/codemirror/codemirror.js"></script>
<script src="/static/sfdp/lib/codemirror/foldcode.js"></script>
<script src="/static/sfdp/lib/codemirror/brace-fold.js"></script>
<script src="/static/sfdp/lib/codemirror/javascript.js"></script>
<script src="__SFDP__/sfdp.7.0.js?v=7.0.1"></script>
<script type="text/javascript" language="javascript">
    $('#code').val(JSON.stringify({$step|raw}, null, 4))
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        lineWrapping: true,
        mode: {name: "javascript", json: true},
        theme: "dracula",	//设置主题
        matchBrackets: true,
        foldGutter: true,
        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
    });
    editor.setSize('auto',"500px");
    editor.foldCode(CodeMirror.Pos(3, 0));
    function test(){
       let where =  $('#where').val();
       if(where ==''){
           layer.msg('您还没有填写查询条件呀！');return
       }
        sfdp.sFun('/gadmin/sapi?fun={$info.fun}',eval("("+where+")"),setinfo);
    }
    function setinfo(ret){
        editor.setValue(JSON.stringify(ret, null, 4))
    }
</script>
</body>
</html>

{include file='common/head' /}
<link rel="stylesheet" type="text/css" href="/static/sfdp/lib/codemirror/codemirror.css" />
<link rel="stylesheet" type="text/css" href="/static/sfdp/lib/codemirror/dracula.css" />
<link rel="stylesheet" href="__LIB__/select2/select2.min.css" />
<style>
    .layui-input-block {
        display: contents;
    }
    .layui-form-select dl{
        z-index:999999;
    }
    .select2-container--default .select2-selection--single {
        height: 38px;
        border: 1px solid rgb(204, 204, 204);
        border-radius: 0px;
    }
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        line-height: 38px;
    }
</style>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">
            <form action="" method="post" name="form" id="form" class="layui-form">
                <input type="hidden" name="sid" value="{$sid}">
                <div class="layui-form-item">
                        <label class="layui-form-label">业务关联：</label>
                        <div class="layui-input-inline">
                            {$data.s_name}
                        </div>
                    <label class="layui-form-label">事件类型：</label>
                    <div class="layui-input-inline">
                        <select name="act" class="this-select" lay-ignore id="act"  datatype="*">
                                <option value="">请选择</option>
                                    <option value="before_access">before_access 前置权限过滤</option>
                                    <option value="add_before">add_before 添加单据前的处理方法</option>
                                    <option value="add_after">add_after 添加单据后的处理方法</option>
                                    <option value="edit_before">edit_before 修改单据前的处理方法</option>
                                    <option value="edit_after">edit_after 修改后的单据处理方法</option>
                                    <option value="check_start">check_start 审核前操作方法</option>
                                    <option value="check_fun">check_fun 审核后操作方法</option>
                                    <option value="del_fun">del_fun 删除前操作方法</option>
                            <option value="list_before">list_before 列表数据加载前</option>
                            <option value="list_after">list_after 列表数据加载后</option>
                            <option value="view_after">view_after 查看加载后</option>
                            <option value="import_fun">import_fun 导入数据处理事件</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item" style='overflow:visible'>
                    <label class="layui-form-label">事件代码：</label>
                    <div class="layui-input-block">
                        <textarea placeholder="" name='code' type="text/plain" style="width:100%;height:450px;display:inline-block;" id='codedata' ></textarea>
                    </div>
                </div>
                <div class="layui-form-item" style="text-align: center">
                        <button type="submit" class="layui-btn layui-btn-sm">保存事件</button>
                </div>
            </form>

{include file='common/footer' /}
<script src="__LIB__/select2/select2.min.js?v=7.0.1"></script>
<script src="/static/sfdp/lib/codemirror/codemirror.js"></script>
<script src="/static/sfdp/lib/codemirror/javascript.js"></script>
<script>
    $(function () {
        g_checkForm($("#form"),false);
    })
</script>
<script type="text/javascript">
    $('.this-select').select2({width: '400'});
    var editor = CodeMirror.fromTextArea(document.getElementById("codedata"), {
        lineNumbers: true,
        lineWrapping: true,
        mode: "text/typescript",
        theme: "dracula",	//设置主题
        matchBrackets: true,
    });
    editor.setSize('auto',document.body.clientHeight +"px");
    $('#act').on('change',function(){
        var act = $('#act').val();
        var sid = '{$sid}';
        $.ajax({
            type:'post',
            dataType:'json',
            data:{sid:sid,act:act},
            url:'{:url("event_find")}',
            success:function(res){
                editor.setValue(res.data);
            }
        });
    });
</script>
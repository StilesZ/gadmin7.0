{include file='common/head' /}
<style>
    .layui-card-body {
        margin: 0 auto;
        background: #fff;
        padding: 20px;
        min-height: 100vh;
    }
</style>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">
            <div class="layui-row">
                <div class="layui-col-md12">
                    <input type="file" id="file" style="display:none;" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
                    <a class="layui-btn layui-btn-sm" onclick="sfdpExcel.loadExcel('file')"><i class="layui-icon">&#xe681;</i>上传excel</a>
                    <a class="layui-btn layui-btn-sm" onclick="r_data()"><i class="layui-icon">&#xe679;</i>回填内容</a>
                    <a class="layui-btn layui-btn-sm" onclick="sfdpExcel.ctrlExcel('Tpl')"><i class="layui-icon">&#xe656;</i>模板下载</a>
                    <a class="layui-btn layui-btn-sm" onclick="location.reload();"><i class="layui-icon">&#xe63d;</i>刷新系统</a>
                </div>
            </div>
            <div class="layui-row">
                <div id="result" contenteditable=""></div>
            </div>
        </div>
        <script type="text/javascript" >
            var zid = getURLParameter('zid');
            var tpl_name = `导入模板.xlsx`
            let td_data = JSON.parse(localStorage.getItem(zid));
            var csv = '';
            for (x in td_data) {
                csv +=  td_data[x]['tpfd_name']+'['+td_data[x]['tpfd_db']+'],'
            }
            var tpl_csv = csv;
            function r_data(){
                //sfdpExcel.ctrlExcel
                var sheet=(sfdpExcel.csvData()).csv;
                if(sheet.length==0){
                    layer.msg(`没有加载模板数据！`);return;
                }
                parent.sfdp_sub_import_save(zid,sheet);
                layer.msg('恭喜，上传成功！');
                //	var index = parent.layer.getFrameIndex(window.name);
                //setTimeout(function(){parent.layer.close(index)}, 1000);
            }
            function getURLParameter(name) {
                var url = window.location.search.substring(1);
                var params = url.split('&');
                for (var i = 0; i < params.length; i++) {
                    var param = params[i].split('=');

                    if (param[0] === name) {
                        return param[1] === undefined ? true : decodeURIComponent(param[1]);
                    }
                }
            }
        </script>
        <script type="text/javascript" src="/static/sfdp/lib/jquery-3.4.1.min.js"></script>
        <script type="text/javascript" src="/static/sfdp/lib/xlsx.core.min.js"></script>
        <script type="text/javascript" src="__SFDP__/lib/layer/3.1.1/layer.js"></script>
        <script type="text/javascript" src="__SFDP__/sfdp.7.0.js?v=7.0.1"></script>
        <script type="text/javascript" src="__SFDP__/sfdp.config.js?v=7.0.1"></script>
        <script type="text/javascript" src="__SFDP__/sfdp.plug.js?v=7.0.1"></script>
        <script type="text/javascript" src="/static/sfdp/sfdp.tool.js"></script>

        </body></html>
{include file='common/head' /}
{$config.load_file.css|raw}
{$config.g_js|raw}
<link rel="stylesheet" type="text/css" href="/static/list/css.css?v=1.0.0">
<body>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">
            <div class="layui-row" style="display: flex;white-space: nowrap;">
                <div style="flex: 1;display: inline-block;">
                    {eq name='sp' value='0'}
                    <div class="">{$btns|raw}<b id='load_btn'></b></div>
                    {else/}
                    <a class="layui-btn layui-btn-sm addbtn layui-btn-primary" onclick="ent_select(`{$sp}`)">确认选择</a>
                    {/eq}
                </div>
                <div class="align-right" style="flex: 1;display: inline-block;">
                    <form id='searchform' method="post" action="" class="layui-form" >
                        <div class="layui-inline" id='search'>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-btn-group">
                                <a class="layui-btn layui-btn-sm layui-btn-primary" id='searchsubmit'  lay-submit lay-filter="search"><i class="layui-icon layui-icon-search" ></i></a>
                                {eq name='sp' value='0'}
                                    <a class="layui-btn layui-btn-sm layui-btn-primary"  onclick="exp_excle('{$config.title}',{:count($config.field)})"><i class="layui-icon layui-icon-export" ></i></a>
                                    <a class="layui-btn layui-btn-sm layui-btn-primary" onclick="exp_print()"><i class="layui-icon layui-icon-print" ></i></a>
                                    <a class="layui-btn layui-btn-sm layui-btn-primary" onclick="help_view({$sid})"><i class="layui-icon layui-icon-help" ></i></a>
                                    {if condition="session('softId') == 1"}
                                    <a class="layui-btn layui-btn-sm layui-btn-primary" onclick='sfdp.openpage("列表控制台","/gadmin/sfdp/sfdpApi.html?act=custom&sid={$sid}")'><i style="color: red;" class="layui-icon layui-icon-console" ></i></a>
                                    {/if}
                                {/eq}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <table id="tabledata" class="layui-table"  lay-filter='tabledata_filter'>
        </div>
    </div>
</div>
{include file='common/footer' /}
<script>
    var Server_Url = '/gadmin/wf/wfdo';
    var System_Url = '/gadmin/sfdp/';
</script>
<script src="__SFDP__/sfdp.plug.js?v=7.0.1"></script>
<script src="__SFDP__/sfdp.7.0.js?v=7.0.1"></script>
<script src="__SFDP__/sfdp.config.js?v=7.0.1"></script>
<script type="text/javascript" src="__FLOW__/workflow.5.0.js"></script>
<script type="text/javascript" src="__SFDP__/lib/laydate5.0.9/laydate.js"></script>
{$config.fun|raw}
<script>
    window.onresize = function (){
        adjustButtons()
    }
    $(document).ready(function() {
        adjustButtons();
        sfdp.generateFilterGroup({$config['search']|raw});/*渲染查询数据*/
        layui.extend({
            treeTable: "{/}/static/layui/lay/layui_ext/treeTable"   // {/}的意思即代表采用自有路径，即不跟随 base 路径
        }).use(['form','layer', 'util', 'treeTable'], function () {
            let form = layui.form;
            var treeTable = layui.treeTable;
            form.render();
            $('.layui-input').keypress(function(e){
                if(e.keyCode==13){
                    e.preventDefault();
                }
            });
            //监听提交  搜索事件
            form.on('submit(search)', function(data){
                var param = {};
                var search = $('#searchform').serializeArray();
                var searchdata = sfdp.list_to_json(search);
                if(searchdata != {}){
                    param.search = searchdata;
                }
                treeTable.reload('tabledata',{
                    page: {curr: 1},
                    where:param
                })
                return false;
            });
            initLaytable();
        })
        try{
            load_list_fun();//后置函数
        }catch(e){
            g_log('page no load end fun ~');
        }
        });
        var config_field = [{type: 'numbers'},{type: 'radio'},{field: 'id',hide:true},{volist name='config.field' id='k'}{field: '{$config['sql_field'][$key]}', title: '{$k}', minWidth: 165},{/volist}{field: 'status',title:'状态'},{field: 'url',title:'操作'}];
        var TableData;
        function initLaytable() {
            var treeTable = layui.treeTable;
            var form = layui.form;
            treeTable.render({
                elem: '#tabledata',
                url: window.location.href,
                where: {page: 1, limit: 99999},
                method: 'post',
                escape:false,
                skin: 'nob',// 无边框风格
                size: 'lg',// 大尺寸
                height: 'full-39',
                tree: {
                    iconIndex: 3,           // 折叠图标显示在第几列
                    isPidData: true,        // 是否是id、pid形式数据
                    idName: 'g_sys_id',  // id字段名称
                    pidName: 'g_sys_pid'     // pid字段名称
                },
                cols: [
                    config_field
                ],
                done: function (res, curr, count) {
                    $(".layui-table-box").css("border-width", "0px");
                    $(".layui-table-header tr").css("height", "40px");
                    $(".layui-table-header tr").css("background-color", "white");
                    $(".layui-table-header tr span").css("color", "#666666");
                    $(".layui-table-body tr").css("height", "40px");
                },
            });
            treeTable.on('radio(tabledata)', function(obj){
                $('input:checkbox').prop('checked',false);
                $("input[name='ids']").prop('checked',false);
                $('input:radio:checked').parent().parent().parent().parent().find('input:checkbox').prop('checked',true);
                form.render();
            });
            treeTable.on('row(tabledata)', function(obj){
                $(obj.tr).find('input:radio').prop('checked',true);
                $('input:checkbox').prop('checked',false);
                $(obj.tr).find('input:checkbox').prop('checked',true);
                form.render();
            });
            treeTable.on('rowDouble(tabledata_filter)', function(obj){
                var Param =  getParam();
                var sid = g_getUrlParam('sid');
                sfdp.openfullpage("查看",`/gadmin/sfdp/view?sid=${sid}&id=${Param[0]}`)
            });
        }
</script>
<script type="text/javascript" src="/static/list/js.js?v1.0"></script>
</body>
</html>
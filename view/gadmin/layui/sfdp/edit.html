<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title></title>
    <link rel="stylesheet" href="__SFDP__/sfdp.7.0.css?v=7.0.0" />
    <link rel="stylesheet" href="/static/layui/layui-v2.8.4/css/layui.css" />
    <link rel="stylesheet" href="__LIB__/select2/select2.min.css" />
    <link rel="stylesheet" href="__SFDP__/lib/selecttree/select2totree.css?v=7.0.1" />
    <link rel="stylesheet" href="__SFDP__/lib/tag/jquery.tagsinput.css?v=7.0.1" />
    <link rel="stylesheet" type="text/css" href="/static/common.css?v=5.0.0">
    <link rel="stylesheet" type="text/css" href="/static/custom.css?v=5.0.0">
    {$config.load_file.css|raw}
    <style>
        .layui-input {
            height: 38px;
        }
        #uploadInfo{
            background-color: white !important;
            border: 1px solid #2d6dcc !important;
            color: #2d6dcc !important;
        }
        .save-btn{
            background-color: white !important;
            border: 1px solid #2d6dcc !important;
            color: #2d6dcc !important;
        }
        .layui-input-block{
            display: flex;
            align-items: center;
        }
        .select2-container .select2-selection--multiple{
            height: 38px;
            border: 1px solid rgb(204, 204, 204);
            border-radius: 0px;
        }
        .select2-container--default .select2-selection--single{
            height: 38px;
            border: 1px solid rgb(204, 204, 204);
            border-radius: 0px;
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
        }
        .select2-container--default .select2-selection--multiple .select2-selection__choice{
            border-radius: 0px;
            height: 23px;
        }
        .table_card {margin: 5px;}
        .table_card .tab { height:37px; font-size:14px; border-bottom:1px #e1e1e1 solid}
        .table_card .tab li { float:left; height:36px; line-height:36px; padding:0 25px; margin-right:5px; background:#f0f0f0; border-top:1px #e1e1e1 solid; border-left:1px #e1e1e1 solid; border-right:1px #e1e1e1 solid;}
        .table_card .tab li:hover { height:37px; background:#fff; color:#333; cursor:pointer}
        .table_card .activ { height:37px !important; background:#fff !important; color:#333}
        .table_card .tabCon { background:#fff; padding:8px; border-bottom:1px #e1e1e1 solid; border-left:1px #e1e1e1 solid; border-right:1px #e1e1e1 solid;}
        .table_card .tabCon div { display:none}
        .table_card .tabCon td .tagsinput, .table_card .tabCon td .tagsinput div { display:block}
        .table_card .tabCon .on { display:block}
        .table_card .title{background-color: #f2f2f2;}
    </style>
</head>
<body>
<!--加载全局变量函数-->
{$config.g_js|raw}
<div class="page-container"><div class="tpfd-content" id='table'></div></div>
<script src="__SFDP__/lib/jquery-3.4.1.min.js"></script>
<script src="__SFDP__/lib/jquery-ui.js"></script>
<script src="__SFDP__/lib/layer/3.1.1/layer.js"></script>
<script src="__LIB__/Validform/5.3.2/Validform.min.js"></script>
<script src="__SFDP__/lib/H5upload.js"></script>
<script src="__SFDP__/lib/laydate5.0.9/laydate.js"></script>
<script src="__SFDP__/sfdp.7.0.js?v=7.0.1"></script>
<script src="__SFDP__/sfdp.config.js?v=7.0.1"></script>
<script src="__SFDP__/sfdp.plug.js?v=7.0.1"></script>
<script src="__SFDP__/sfdp.editor.js?v=5.0.322222"></script>
<script src="__LIB__/select2/select2.min.js?v=7.0.1"></script>
<script src="/static/common.js?v=7.0.1"></script>
<script src="/static/custom.js?v=3.1.4"></script>
<script src="__SFDP__/lib/selecttree/select2totree.js?v=7.0.1"></script>
<script src="__SFDP__/lib//tag/jquery.tagsinput.js?v=7.0.1"></script>
<script type="text/javascript" src="__LIB__/qrcode.min.js"></script>
{$config.load_file.js|raw}
<script>
    $("head").append(sfdp.ui.ui_css);
</script>
<!--动态加载用户自定义脚本-->
{$config.fun|raw}
<!--脚本结束-->
<script>
    var g_bill_id = '{$id ?? ""}';
    var showtype = '{$showtype}';
    var s_type = '{$config["s_type"]}';
    var is_wf = '{$is_wf}';
    var uploadurl = '{:url($config["upload_file"])}';
    var uploadurls = '{:url($config["upload_files"])}';
    try{
        load_satr_fun(showtype);//后置函数
    }catch(e){
        if(Debug){
            console.log('page no load star fun ~');
        }
    }
    $( function() {
        sfdp.showadd({$data|raw},showtype);
        $('.this-select').select2({width:'100%'});
        $('.tagInput').tagsInput({defaultText: '回车输入..',width:'100%'});
        $("#form").Validform({
            tiptype:function(msg,o,cssctl){
                if (o.type == 3){
                    $(".savedata").attr('is_post',0);
                    layer.msg(msg, {time: 800});
                }
            },
            beforeSubmit:function(curform){
                try{
                    return load_form_check(curform);//后置函数
                }catch(e){
                    if(Debug){
                        console.log('表单验证后，进行验算');
                    }
                }
            },
            ajaxPost:true,
            postonce:true,
            showAllError:false,
            callback:function(ret){
                if (ret.code === 1) {
                    $(".savedata").attr('is_post',0);
                }
                sfdp.common_return(ret);
            }
        });
        $(".savedata").click(function(){
            $('#subdata_subdata').val(sfdp.sub_to_json());
            if($(".savedata").attr('is_post')==0){
                $(".savedata").attr('is_post',1);
                $("#form").submit();
                }else{
                layer.msg(`重复提交`, {time: 800});
            }
        });
    });
    $(document).on("input propertychange", "#row-title", function (e) {
        var title = $('#row-title').val();
        var p_id = $('#row-id').val();
        $('#' + p_id + '_title').html(title);
        sfdp.dataSave(title, p_id, 'sublist_title');
    });

    $('body').on('input propertychange', ".this-select", function(event) {
        var is_dx = $(this).attr("multiple");
        if(is_dx !=undefined){
            var o=document.getElementById($(this).attr("id")).getElementsByTagName('option');
            var all="";
            for(var i=0;i<o.length;i++){
                if(o[i].selected){
                    all+=o[i].value+",";
                }
            }
           document.getElementById($(this).attr("id")+'_val').value = all.substr(0, all.length - 1);
        }
    });
    $(document).ready(function(){
        if(is_wf && is_wf==1){
            $('.savedata').after('<a class="layui-btn wfbtn" onclick="save2()" style="background-color: #f66f6a;">保存&发起</a>')
        }
        try{
            load_end_fun(showtype);//后置函数
        }catch(e){
            if(Debug){
                console.log('page no load end fun ~');
            }
        }
    });
    function save2(){
        $('#form').append(`<input type='hidden'name='g_is_wf' value='1'>`);
        $('#subdata_subdata').val(sfdp.sub_to_json());
        if($(".savedata").attr('is_post')==0){
            $(".savedata").attr('is_post',1);
            $("#form").submit();
        }else{
            layer.msg(`重复提交`, {time: 800});
        }
    }
</script>
<script type="text/javascript">
    $(document).ready(function(e) {
        $(".tab li").click(function(){
            $(this).parent(".tab").children("li").eq($(this).index()).addClass("activ").siblings().removeClass("activ");
            $(this).parent().parent().children(".tabCon").children("div").hide().eq($(this).index()).show();
        })
    });

</script>
</body>
</html>

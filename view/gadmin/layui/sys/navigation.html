{include file='common/head' /}
<style>
    #flowdesign_canvas {
        min-height: 300px;
        background-color: #FFFFFF;
        height: calc(100% - 35px);
        width: 100%;
        padding: 15px;
        box-sizing: border-box;
    }
    .wf_btn {
        padding: 4px 8px;
        box-sizing: border-box;
        cursor: pointer;
        text-align: center;
        border: solid 1px #ddd;
        background-color: #fff;
        width: auto;
    }
    .process-step {
        position: absolute;
        cursor: move;
        min-width: 100px;
        line-height: 28px;
    }
    * body, html {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 12px;
        color: #444;
        height: 100%;
        padding: 0;
        margin: 0;
    }
</style>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15 custom-table-content">
        <div style="width: 280px;float: left;border-radius: 4px;">
            <div class="layui-card">
                <style>
                    .layui-card-body {
                        padding: 5px
                    }
                    .layui-card-header {
                        font-weight: 700;
                    }
                    .ul li{
                        font-size: 15px;
                        list-style: none;
                        font-weight: 400;
                        line-height: 32px;
                        padding: 6px;
                    }

                    .ul-this span{
                        color: #5e7ce0;font-weight: 700
                    }
                </style>
                <div class="layui-card-header">
                  ₪ 系统方案<a style="float: right;margin-left: 5px;" class="layui-btn layui-btn-sm" onclick="tag()">方案</a>
                </div>
                <div class="layui-card-body">
                    <ul style="padding: 10px;" class="ul">
                        {volist name='type' id='k'}
                            <a href="{:url('navigation')}?pid={$k.id}" target="_self">
                             <li {eq name="pid" value="$k.id"}class="ul-this"{/eq}><span class="layui-badge-dot layui-bg-{$k.color}"></span>
                                <span>{$k.title}</span>
                                {eq name="pid" value="$k.id"}
                                <a style="float: right;" class="layui-btn layui-btn-sm layui-btn-primary"  onclick="add({$k.id})">节点</a>
                                {/eq}
                                </li>
                            </a>
                        {/volist}
                    </ul>
                </div>
            </div>
        </div>
        <div style="padding-left: 0px;float: left;border-radius: 4px;width: calc(100% - 310px);">
            <div class="layui-card">
                <div class="main">
                        <div id="flowdesign_canvas" width="100%"  style='background-image: linear-gradient(90deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%), linear-gradient(360deg, rgba(50, 0, 0, 0.05) 3%, rgba(0, 0, 0, 0) 3%);background-size: 20px 20px;'>
                            <a style="float: right;" class="layui-btn layui-btn-sm layui-btn-primary"  onclick="Navi.Api('save')">保存</a>
                            <a style="float: right;" class="layui-btn layui-btn-sm layui-btn-primary"  onclick="node()">挂载</a>
                            <a style="float: right;" class="layui-btn layui-btn-sm layui-btn-primary"  onclick="Navi.Api('Refresh')">刷新</a>
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>
{include file='common/footer' /}

<script src="__LIB__/navigation/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="__LIB__/navigation/jsPlumb-1.3.16-all-min.js"></script>
<script type="text/javascript" src="__LIB__/navigation/Navi.1.0.js?v=11" ></script>
<script type="text/javascript" src="__LIB__/navigation/jquery-ui-1.9.2-min.js?" ></script>
<script>
    var _this = $('#flowdesign_canvas');
    var the_flow_id = '{$pid}';
    var Server_Url ='/gadmin/sys/navigation_save';
    function resize(){
        const height=document.body.offsetHeight;
        $('#flowdesign_canvas').height(height-20);
    }
    window.onresize = function (){
        resize()
    }
    resize();
    function tag(){
        layer_show('方案类别','{:url("navigation_tag")}','85','70');
    }
    function add(id){
        layer_show('新增方案节点','{:url("navigation_add")}?id='+id,'85','50');
    }
    $(function(){
        Navi.Init({$process_data|raw});
    });
    function node(){
        var htmls = '<div style="margin:10px;">节点：<select id="nodesss"  style="width: 60%;height: 25px" ><option value="">请选择挂带节点</option>{$Node['html']|raw}</select>　<a onClick=getmenu('+the_flow_id+')  class="layui-btn layui-btn-sm layui-btn-danger">导入目录</a></div>';
        layer.open({
            title: '选择导入目录层级',
            type: 1,
            area: ['520px', '150px'], //宽高
            content: htmls
        });
    }
    function getmenu(sid){
        var node = $('#nodesss').val();
        if(node==''){
            layer.msg('请选择节点信息！');
            return;
        }
        var url = Server_Url+"?act=node";
        Navi.sPost(url,{"sid":sid,"node":node});
    }
</script>
</body>
</html>

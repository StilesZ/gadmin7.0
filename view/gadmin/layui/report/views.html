{include file='common/head' /}
<link rel="stylesheet" href="__LIB__/jexcel/jquery.jexcel.css" type="text/css">
<style>
    td {
        white-space: nowrap;
    }
    td {
        white-space: nowrap;
    }
    .table-container {
        width: 100%;
        height: 100%;
        overflow: auto;
    }

    /* 首列固定 */
    .table-container thead tr > th:first-child,
    .table-container tbody tr > td:first-child {
        position: sticky;
        left: 0;
        z-index: 1;
    }

    /* 表头固定 */
    .table-container thead tr > th {
        position: sticky;
        top: 0;
        z-index: 2;    background: #e6e6e6;

    }

    /* 表头首列强制最顶层 */
    .table-container thead tr > th:first-child {
        z-index: 3;
    }
</style>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">
            <div class="layui-row flex-center">
                <div class="layui-col-md3">
                    <button href="#" class="layui-btn layui-btn-sm" id='download'>导出报表</button>
                    <a href="javascript:jqprint()" class='layui-btn layui-btn-sm'>打印预览</a>
                </div>

                <div class="layui-col-md9 align-right">
                    <form action="" method="post" name="form" id="form">
                    <div class="layui-inline">
                        <div class="layui-input-inline">
                            {$headInfo|raw}
                        </div>
                    </div>
                    <div class="layui-inline">
                        <button class="layui-btn layuiadmin-btn-comm layui-btn-sm"  id='searchsubmit'>
                            <i class="layui-icon layui-icon-search layuiadmin-button-btn" ></i>
                        </button>
                    </div>
                    </form>
                </div>
            </div>
            <div style='margin-top:20px' id="jqprint">
                {if condition='count($result)>=1'}
                <table class="layui-table table2excel" id='yourHtmTable' style='min-width:1200px' width='100%'>
                    <thead class="jexcel_label">
                    <tr width="98%">
                        {volist name='head' id='k'}
                        <th>
                            {php}
                            echo str_replace(array("*count"),"",$k)
                            {/php}
                            </th>
                        {/volist}
                    </tr>
                    </thead>
                    <tbody>
                    {volist name='result' id='k'}
                    <tr>
                        {volist name='head' id='ks'}
                        <td>{$k["$ks"]|raw}
                            {php}
                            if(strpos($ks,'@') !== false){
                            $url= explode("@",$ks);
                            echo " <a
                                    onclick=sfdp.openfullpage('报表阅读','".url('views_s')."?action=".$url[1]."&".$url[2]."=".$k["$url[3]"]."')><i
                                    class='layui-icon layui-icon-release'></i></a>";
                            }
                            {/php}
                        </td>
                        {/volist}
                    </tr>
                    {/volist}
                    </tbody>
                    {if condition='count($count)>=1'}
                    <tr width="98%">
                        <td colspan="{:count($head)}">
                            {volist name='$count' id='c'}
                            <span class="layui-badge layui-bg-blue">{$key}</span> 总数 {$c.count} 汇总求和：{$c.sum}
                            {/volist}
                        </td>
                    </tr>
                    {/if}
                </table>
                {else/}
                <h2>Sorry,查无数据！</h2>
                {/if}
            </div>
        </div>
    </div>
    {include file='common/footer' /}
    <script src="__SFDP__/sfdp.7.0.js"></script>
    <script src="__SFDP__/lib/laydate5.0.9/laydate.js"></script>
    <script src="__LIB__/jexcel/jquery.table2excel.min.js"></script>
</div>
</body>
</html>
<script>
    $(".datetime").click(function () {
        var id = $(this).attr('id');
        laydate.render({
            elem: '#' + id,
            format: 'yyyy-MM-dd',
            show: true
            , closeStop: '.datetime'
        });
    });
    $("#download").click(function () {
        $("#yourHtmTable").table2excel({
            exclude: ".noExl",
            name: "Excel Document Name",
            filename: "报表系统",
            exclude_img: true,
            exclude_links: true,
            exclude_inputs: true
        });
    });
</script>
<script type="text/javascript"src="__LIB__/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript"src="__LIB__/jquery.jqprint-0.3.js"></script>
<script language="javascript">
    function jqprint() {
        $("#jqprint").jqprint();
    }
</script>